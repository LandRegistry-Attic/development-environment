#!/bin/bash

#Uncomment this line if you want to debug this script
#set -x
set -e

case `uname` in
    Linux)
        if [[ ! -d /vagrant ]] ; then
            echo "You need to be running in the vagrant VM to do this"
            exit 1
        fi
    ;;

    *)
        
        echo
        echo
        echo "You need to be running in your vagrant virtual machine to run this."
        echo
        echo "Run vagrant ssh from the root directory of the development environment and then re-run this script"
        echo
        exit 1
    ;;
esac

source /vagrant/script/checkout

if [[ -d tests ]] ; then
    create_virtual_env $1
    install_requirements
    
    if [[ -z ${SETTINGS} ]] ; then
    	echo "Configuring SETTINGS to be config.TestConfig"
    	echo "Please ensure you have a config.TestConfig in your project"
    	export SETTINGS="config.TestConfig"
    fi

    py.test
else
    echo "No unit tests found in directory ${app_name}"
    echo 
    echo "You need to run this in a directory containing an application (normally /vagrant/apps/<app-name>)"
    echo "or specify an app name: run-unit-tests <app-name>"
fi
