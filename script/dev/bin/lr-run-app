#!/bin/bash

#Uncomment this line if you want to debug this script
#set -x
set -e

script_to_run=${@}

if [[ -z ${script_to_run} ]] ; then
	if [[ -f run.sh ]] ; then	
		echo "Defaulting to run.sh as startup script"
		script_to_run="run.sh"
	else
		echo "You haven't supplied a script to run and there is no run.sh in your project"
		echo "I don't know what you want me to start"
		exit 1
	fi
fi

source /vagrant/script/dev/configure
source /vagrant/script/dev/virtualenv-functions

create_virtual_env
workon ${app_name}
install_requirements

# TODO: MW - tech debt --
# Currently our run.sh scripts in the apps don't always work with set -e in place
# because we're not running proper database migrations.
# Until we've sorted out the apps we'll disable -e here

set +o errexit
. ${script_to_run}
set -e
