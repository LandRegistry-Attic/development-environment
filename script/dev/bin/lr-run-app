#!/bin/bash

#Uncomment this line if you want to debug this script
#set -x
set -e

case `uname` in
	Linux)
		if [[ ! -d /vagrant ]] ; then
			echo "You need to be running in the vagrant VM to do this"
			exit 1
		fi
	;;

	*)
		
		echo
		echo
		echo "You need to be running in your vagrant virtual machine to run this."
		echo
		echo "Run vagrant ssh from the root directory of the development environment and then re-run this script"
		echo
		exit 1
	;;
esac

if [[ ! -f run.sh ]] ; then		
		echo
		echo "You haven't supplied an application name and there is no run.sh in the current directory [`pwd`]"
		echo "I don't know what applications you want me to start!"
		echo
		echo "Either run this script from an application directory in /vagrant/apps"
		echo "or pass in application names by executing" 
		echo
		echo "lr-run-app app1 app2 app3"
		echo
		exit 0 # Not necessarily an error, some apps are not auto-startable
fi

source /vagrant/script/dev/virtualenv-functions

create_virtual_env
install_requirements

# TODO: MW - tech debt --
# Currently our run.sh scripts in the apps don't always work with set -e in place
# because we're not running proper database migrations.
# Until we've sorted out the apps we'll disable -e here

set +o errexit
source run.sh
deactivate
set -e
