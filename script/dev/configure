#!/bin/bash

export WORKON_HOME=~/.land-registry-python-venvs
mkdir -p ${WORKON_HOME}

if [[ -z `which foreman` ]] ; then
	echo "No local foreman installed. Installing"
	sudo gem install foreman
fi

if [[ -z `which sass` ]] ; then
	echo "Cant find sass. Installing"
	sudo gem install sass
fi

if [[ -z `which pip` ]] ; then 
	echo "Can't find pip. Installing..."
	sudo easy_install pip
fi

sudo pip install setuptools==3.6

if [[ -z `which virtualenvwrapper.sh` ]] ; then 
	echo "Can't find virtualenvwrapper.sh. Installing..."
	sudo pip install -U virtualenvwrapper
fi

case `uname -s` in
	Darwin)
		if [[ ! -d "/Applications/Postgres.app" ]] ; then
			echo "Can't find postgress. Installing..."
			rm -rf /tmp/pg.zip /tmp/Postgres.app
			curl -L https://github.com/PostgresApp/PostgresApp/releases/download/9.3.4.2/Postgres-9.3.4.2.zip > /tmp/pg.zip
			unzip /tmp/pg.zip -d /tmp
			sudo mv /tmp/Postgres.app /Applications
		fi

		export PATH=${PATH}:/Applications/Postgres.app/Contents/Versions/9.3/bin
		open /Applications/Postgres.app
	;;
esac

source `which virtualenvwrapper.sh`

if [[ -f dev/port ]] ; then
 	port=`cat dev/port`
 	echo "Setting HTTP port to ${port}"
 	export PORT=${port}
fi

