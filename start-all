#!/bin/bash

# Uncomment next line to enable debug
#set -x
set -e

./bootstrap

source script/dev/configure
apps_and_ports=`cat script/apps | grep -v \# | grep -v '^\s*$'`
rm -f ./Procfile

for app_and_port in ${apps_and_ports}; do
	app=`echo ${app_and_port} | cut -d':' -f1`
    run="apps/${app}/run.sh"
	
	if [[ -f ${run} ]]
 	then
 		echo "Merging global foreman procfile for ${app}"
        app_name=$(echo $app |  sed 's/-//g' )
 		echo "${app_name}: script/start ${app}" >> Procfile
 	else
 		echo "There is not a run.sh present in ${app} so I'm not going to start it for you"
	fi
done

foreman start
